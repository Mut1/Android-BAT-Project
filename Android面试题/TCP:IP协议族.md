- 一系列协议所组成的一个网络分层模型 
- 为什么要分层?因为现实网络的不可靠性
- 具体分层：
  - Application Layer应用层:HTTP、FTP、DNS
  - Transport Layer传输层:TCP、UDP
  - Internet Layer网络层:IP
  - Link Layer数据链路层:以太网、Wi-Fi

#### TCP连接

##### 什么叫连接？

通信双⽅建⽴确认「可以通信」，不会将对⽅的消息丢弃，即为「建⽴连接」

##### TCP连接的建立

- 三次握手🤝
- 作用：
  - “3次握手”的作用就是`双方都能明确自己和对方的收、发能力是正常的`

##### TCP连接的关闭

- 四次挥手👋🏻
- 作用：
  - 因为当服务端收到客户端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中**ACK报文是用来应答的，SYN报文是用来同步的**。但是关闭连接时，当服务端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉客户端，"你发的FIN报文我收到了"。只有等到我服务端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四次挥手。

##### 长连接

- 为什么要长连接？

  因为移动⽹络并不在 Internet 中，⽽是在运营商的内⽹，并不具有真正的公⽹ IP， 因此当某个 TCP 连接在⼀段时间不通信之后，⽹关会出于⽹络性能考虑⽽关闭这条 TCP 连接和公⽹的连接通道，导致这个 TCP 端⼝不再能收到外部通信消息，即 TCP 连接被动关闭。

- 长连接的实现方式：

  ⼼跳。即在⼀定间隔时间内，使⽤ TCP 连接发送超短⽆意义消息来让⽹关不能将⾃ ⼰定义为「空闲连接」，从⽽防⽌⽹关将⾃⼰的连接关闭。

#### Http协议与TCP/IP 协议的关系

Http的长连接和短连接本质上是TCP长连接和短连接。HTTP属于应用层协议，在传输层使用TCP协议，在网络层使用IP协议。IP协议主要解决网络路由和寻址问题，TCP协议主要解决如何在IP层之上可靠的传递数据包，使在网络上的另一端收到发端发出的数据包，并且顺序与发出顺序一致。TCP有可靠，面向连接的特点。

#### Http/TCP/Socket连接

##### Http连接

**Http协议**，即超文本传输协议。Http协议是建立在TCP协议之上的一种**应用**。

Http协议负责如何**包装数据**，而TCP协议负责如何**传输数据**。

HTTP连接最显著的特点**是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接**。从建立连接到关闭连接的过程称为“一次连接”。

> 在HTTP/1.0中，默认使用的是短连接。但从 HTTP/1.1起，默认使用长连接。

##### TCP连接

TCP连接需要经过“三次握手”，断开连接需要经过“四次挥手”。

<img src="图片/TCP:IP协议族.assets/1" alt="img" style="zoom:50%;" />

#### Socket连接

##### Socket连接和TCP连接的关系

创建Socket连接时，可以指定使用的传输层协议，Socket可以支持不同的传输层协议（TCP或UDP），当**使用TCP协议进行连接时，该Socket连接就是一个TCP连接**。

##### Socket连接和Http连接的关系

Socket连接一般情况下都是TCP连接，因此Socket连接一旦建立，通信双方就可以进行**互相发送内容**。

客户端到服务器之间的通信往往需要穿越多个中间节点，例如路由器、网关、防火墙等，大部分防火墙默认会关闭长时间处于非活跃状态的连接而导致 Socket 连接断连，因此需要通过轮询告诉网络，该连接处于活跃状态。（**这也就是常说的“心跳策略”**）

Http连接是**“请求-响应”**的方式，不仅在请求时需要先建立连接，而且需要客户端向服务器发出请求后，服务器端才能回复数据。

> 总结：如果建立的是Socket连接，服务器可以直接将数据传送给客户端；如果方建立的是HTTP连接，则服务器需要等到客户端发送一次请求后才能将数据传回给客户端。

#### Http长连接和TCP长连接的区别

Http长连接 和 TCP长连接的区别在于: **TCP 的长连接需要自己去维护一套心跳策略。**而Http只需要在请求头加入`keep-alive:true`即可实现长连接。

